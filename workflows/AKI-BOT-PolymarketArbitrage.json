{
    "name": "AKI-BOT-PolymarketArbitrage",
    "nodes": [
          {
                  "parameters": {
                            "rule": {
                                        "interval": [{ "field": "minutes", "minutesInterval": 5 }]
                            }
                  },
                  "id": "arb-trigger",
                  "name": "Every 5 Minutes",
                  "type": "n8n-nodes-base.scheduleTrigger",
                  "position": [250, 300]
          },
          {
                  "parameters": {
                            "method": "GET",
                            "url": "https://gamma-api.polymarket.com/markets?closed=false&limit=100",
                            "options": { "timeout": 15000 }
                  },
                  "id": "fetch-markets",
                  "name": "Fetch Polymarket Markets",
                  "type": "n8n-nodes-base.httpRequest",
                  "position": [450, 300],
                  "continueOnFail": true
          },
          {
                  "parameters": {
                            "jsCode": "const markets = $input.first().json;\n\nif (!Array.isArray(markets)) {\n  return [{ json: { error: 'Failed to fetch markets', raw: markets } }];\n}\n\nconst opportunities = [];\n\nmarkets.forEach(market => {\n  if (market.outcomePrices && market.outcomePrices.length >= 2) {\n    const prices = market.outcomePrices.map(p => parseFloat(p) || 0);\n    const totalPrice = prices.reduce((sum, p) => sum + p, 0);\n    const deviation = Math.abs(1 - totalPrice);\n    \n    if (deviation > 0.02) {\n      const profitPercent = totalPrice < 1 \n        ? ((1 - totalPrice) / totalPrice * 100).toFixed(2)\n        : ((totalPrice - 1) / 1 * 100).toFixed(2);\n      \n      opportunities.push({\n        market_id: market.id,\n        question: market.question?.substring(0, 100),\n        slug: market.slug,\n        outcome_prices: prices,\n        total_price: totalPrice.toFixed(4),\n        deviation: (deviation * 100).toFixed(2) + '%',\n        opportunity_type: totalPrice < 1 ? 'BUY_ALL' : 'OVERPRICED',\n        potential_profit_percent: profitPercent + '%',\n        volume_24h: market.volume24hr || 0,\n        liquidity: market.liquidity || 0,\n        score: (deviation * 100) * Math.log10((market.liquidity || 1) + 1)\n      });\n    }\n  }\n});\n\nopportunities.sort((a, b) => b.score - a.score);\n\nreturn [{\n  json: {\n    scan_time: new Date().toISOString(),\n    markets_scanned: markets.length,\n    opportunities_found: opportunities.length,\n    top_opportunities: opportunities.slice(0, 10)\n  }\n}];"
                  },
                  "id": "find-arbitrage",
                  "name": "Find Arbitrage",
                  "type": "n8n-nodes-base.code",
                  "position": [650, 300]
          },
          {
                  "parameters": {
                            "conditions": {
                                        "options": { "caseSensitive": true },
                                        "conditions": [
                                                      {
                                                                      "leftValue": "={{ $json.opportunities_found }}",
                                                                      "rightValue": 0,
                                                                      "operator": { "type": "number", "operation": "gt" }
                                                      }
                                        ]
                            }
                                          },
                  "id": "check-opportunities",
                  "name": "Has Opportunities?",
                  "type": "n8n-nodes-base.if",
                  "position": [850, 300]
          },
          {
                  "parameters": {
                            "method": "POST",
                            "url": "={{ $vars.N8N_WEBHOOK_BASE_URL }}/webhook/aki-log",
                            "sendBody": true,
                            "specifyBody": "json",
                            "jsonBody": "={\n  \"level\": \"INFO\",\n  \"source\": \"POLYMARKET_BOT\",\n  \"agent\": \"QNT-ARB\",\n  \"category\": \"trade\",\n  \"message\": \"Arbitrage scan completed: {{ $json.opportunities_found }} opportunities found\",\n  \"details\": {{ JSON.stringify($json) }}\n}",
                                                  "options": {}
                  },
                  "id": "log-scan",
                  "name": "Log Scan",
                          "type": "n8n-nodes-base.httpRequest",
                  "position": [1050, 200]
          },
          {
                  "parameters": {
                            "jsCode": "console.log('No significant opportunities found');\nreturn [{ json: { status: 'no_opportunities', timestamp: new Date().toISOString() } }];"
                  },
                  "id": "log-no-opp",
                  "name": "Log No Opportunities",
                  "type": "n8n-nodes-base.code",
                  "position": [1050, 400]
          }
    ],
    "connections": {
          "Every 5 Minutes": { "main": [[{ "node": "Fetch Polymarket Markets", "type": "main", "index": 0 }]] },
          "Fetch Polymarket Markets": { "main": [[{ "node": "Find Arbitrage", "type": "main", "index": 0 }]] },
          "Find Arbitrage": { "main": [[{ "node": "Has Opportunities?", "type": "main", "index": 0 }]] },
          "Has Opportunities?": {
                  "main": [
                            [{ "node": "Log Scan", "type": "main", "index": 0 }],
                            [{ "node": "Log No Opportunities", "type": "main", "index": 0 }]
                  ]
          }
    },
    "active": false,
    "settings": { "executionOrder": "v1" },
    "tags": [{ "name": "AKI-BOT" }, { "name": "AKI-POLYMARKET" }, { "name": "AKI-TRADING" }]
}
